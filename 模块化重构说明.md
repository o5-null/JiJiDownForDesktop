# JiJiDown Desktop 模块化重构说明

## 重构概述

本次重构将原有的 `main.py` 文件（1184行）按功能拆分为多个独立的模块，提高了代码的可维护性和可读性。

## 重构后的模块结构

### 1. 主程序入口模块
- **文件**: `app.py`
- **功能**: 程序启动、配置初始化、路由设置
- **包含**:
  - `initialize_config()` - 配置初始化
  - `setup_routes()` - 路由设置
  - `main()` - 主程序入口

### 2. 主页UI模块
- **文件**: `ui_home.py`
- **功能**: 主页面的UI组件和功能
- **包含**:
  - `create_home_page()` - 创建主页UI组件
  - 系统信息显示
  - 核心状态监控
  - 下载功能
  - 页面导航

### 3. 设置页面UI模块
- **文件**: `ui_settings.py`
- **功能**: 设置页面的UI组件和功能
- **包含**:
  - `create_settings_page()` - 创建设置页面UI组件
  - 基本设置、下载设置、网络设置、用户设置、高级设置
  - 配置验证和保存功能

### 4. 日志页面UI模块
- **文件**: `ui_log.py`
- **功能**: 日志页面的UI组件和功能
- **包含**:
  - `create_log_page()` - 创建日志页面UI组件
  - 核心运行状态管理
  - 日志显示和控制
  - 核心启动/停止功能

### 5. 核心状态管理模块
- **文件**: `core_status.py`
- **功能**: 管理核心运行状态和全局缓存变量
- **包含**:
  - `update_core_status()` - 更新核心状态
  - `get_core_status()` - 获取核心状态
  - `is_core_running()` - 检查核心是否运行
  - `get_core_info()` - 获取核心文件信息

### 6. 日志管理器模块
- **文件**: `log_manager.py`
- **功能**: 日志的持久化存储和恢复
- **包含**:
  - `CoreLogManager` 类
  - 日志归档、清理、保存、加载、清空功能

## 现有模块（保持不变）

### 1. 配置管理器模块
- **文件**: `config_manager.py`
- **功能**: 配置文件管理

### 2. 核心管理器模块
- **文件**: `core_manager.py`
- **功能**: 核心文件管理和下载

### 3. 系统信息模块
- **文件**: `system_info.py`
- **功能**: 系统信息获取

### 4. 工具模块
- **文件**: `utils.py`
- **功能**: 通用工具函数

## 模块依赖关系

```
app.py (主程序入口)
├── ui_home.py (主页UI)
│   ├── core_manager.py (核心管理)
│   ├── config_manager.py (配置管理)
│   ├── system_info.py (系统信息)
│   ├── utils.py (工具函数)
│   └── core_status.py (核心状态)
├── ui_settings.py (设置页面UI)
│   ├── config_manager.py (配置管理)
│   └── utils.py (工具函数)
└── ui_log.py (日志页面UI)
    ├── core_manager.py (核心管理)
    ├── config_manager.py (配置管理)
    ├── system_info.py (系统信息)
    ├── log_manager.py (日志管理)
    └── core_status.py (核心状态)
```

## 重构优势

1. **模块化**: 每个模块职责单一，便于维护
2. **可读性**: 代码结构清晰，功能划分明确
3. **可测试性**: 模块独立，便于单元测试
4. **可扩展性**: 新增功能只需添加新模块
5. **复用性**: 通用功能可在不同模块间复用

## 运行方式

重构后，程序的主入口变更为 `app.py`：

```bash
python app.py
```

原有的 `main.py` 文件仍然保留，但建议使用新的模块化结构。

## 注意事项

1. 所有模块都遵循项目编码规范
2. 使用 pathlib 处理文件路径，避免字符串拼接
3. 模块间通过清晰的接口进行通信
4. 保持了原有的功能完整性和兼容性